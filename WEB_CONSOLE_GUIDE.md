# ç½‘é¡µç‰ˆ Cloud Run é…ç½®ä¿®å¤æŒ‡å—

## ğŸŒ é€šè¿‡ Google Cloud Console ä¿®å¤è½¬æ¢å¤±è´¥é—®é¢˜

### æ­¥éª¤ 1: ç™»å½• Cloud Console

1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/)
2. ç™»å½•ä½ çš„ Google è´¦å·
3. ç¡®ä¿é€‰æ‹©äº†æ­£ç¡®çš„é¡¹ç›® (`pdf2md-486205`)

---

### æ­¥éª¤ 2: è¿›å…¥ Cloud Run æœåŠ¡

**æ–¹æ³• 1: ç›´æ¥é“¾æ¥**
```
https://console.cloud.google.com/run/detail/australia-southeast1/pdf2md-test
```

**æ–¹æ³• 2: æ‰‹åŠ¨å¯¼èˆª**
1. ç‚¹å‡»å·¦ä¸Šè§’ â˜° èœå•
2. æ‰¾åˆ° "Cloud Run"
3. ç‚¹å‡»æœåŠ¡åˆ—è¡¨ä¸­çš„ `pdf2md-test`

---

### æ­¥éª¤ 3: ç¼–è¾‘æœåŠ¡é…ç½®

1. åœ¨æœåŠ¡è¯¦æƒ…é¡µé¢,ç‚¹å‡»é¡¶éƒ¨çš„ **"EDIT & DEPLOY NEW REVISION"** (ç¼–è¾‘å¹¶éƒ¨ç½²æ–°ç‰ˆæœ¬) æŒ‰é’®

   ![Edit Button](https://i.imgur.com/example.png)

2. ä½ ä¼šçœ‹åˆ°é…ç½®è¡¨å•,éœ€è¦ä¿®æ”¹ä»¥ä¸‹è®¾ç½®:

---

### æ­¥éª¤ 4: ä¿®æ”¹å®¹å™¨é…ç½®

#### ğŸ“¦ å®¹å™¨è®¾ç½®

åœ¨ **"Container(s), Volumes, Networking, Security"** éƒ¨åˆ†:

1. **Memory (å†…å­˜)**
   - å½“å‰å¯èƒ½æ˜¯: `512 MiB` æˆ– `1 GiB`
   - **æ”¹ä¸º**: `2 GiB` â¬…ï¸ **é‡è¦!**

2. **CPU**
   - å½“å‰å¯èƒ½æ˜¯: `1`
   - **æ”¹ä¸º**: `2` â¬…ï¸ **æ¨è**

3. **Request timeout (è¯·æ±‚è¶…æ—¶)**
   - å½“å‰å¯èƒ½æ˜¯: `300` ç§’ (5 åˆ†é’Ÿ)
   - **æ”¹ä¸º**: `3600` ç§’ (1 å°æ—¶) â¬…ï¸ **é‡è¦!**

#### ğŸ”§ å…·ä½“æ“ä½œ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Container settings                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Memory:        [2 GiB      â–¼]          â”‚  â¬…ï¸ é€‰æ‹© 2 GiB
â”‚                                         â”‚
â”‚ CPU:           [2          â–¼]          â”‚  â¬…ï¸ é€‰æ‹© 2
â”‚                                         â”‚
â”‚ Request timeout: [3600] seconds        â”‚  â¬…ï¸ è¾“å…¥ 3600
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ­¥éª¤ 5: ä¿®æ”¹è‡ªåŠ¨æ‰©ç¼©å®¹è®¾ç½®

åœ¨ **"Capacity"** (å®¹é‡) éƒ¨åˆ†:

1. **Maximum number of instances** (æœ€å¤§å®ä¾‹æ•°)
   - è®¾ç½®ä¸º: `2`

2. **Minimum number of instances** (æœ€å°å®ä¾‹æ•°)
   - **æ¨è**: `0` (æŒ‰éœ€å¯åŠ¨,çœé’±)
   - **å¦‚æœè¦å¿«é€Ÿå“åº”**: `1` (å§‹ç»ˆä¿æŒä¸€ä¸ªå®ä¾‹è¿è¡Œ)

3. **Maximum concurrent requests per instance** (æ¯ä¸ªå®ä¾‹æœ€å¤§å¹¶å‘è¯·æ±‚æ•°)
   - **æ”¹ä¸º**: `1` â¬…ï¸ **é‡è¦!** (å› ä¸º Marker AI æ¶ˆè€—èµ„æºå¤§)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Autoscaling                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Min instances:     [0]                 â”‚  â¬…ï¸ çœé’±: 0, å¿«é€Ÿ: 1
â”‚ Max instances:     [2]                 â”‚  â¬…ï¸ è®¾ç½® 2
â”‚                                         â”‚
â”‚ Concurrency                             â”‚
â”‚ Max requests:      [1]                 â”‚  â¬…ï¸ è®¾ç½® 1
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ­¥éª¤ 6: é€‰æ‹©æ‰§è¡Œç¯å¢ƒ

åœ¨ **"Execution environment"** éƒ¨åˆ†:

- é€‰æ‹©: **"Second generation"** (ç¬¬äºŒä»£) â¬…ï¸ æ”¯æŒæ›´å¤šå†…å­˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Execution environment                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â—‹ First generation                      â”‚
â”‚ â— Second generation    â¬…ï¸ é€‰æ‹©è¿™ä¸ª       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ­¥éª¤ 7: ä¿å­˜å¹¶éƒ¨ç½²

1. æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨
2. ç‚¹å‡»è“è‰²çš„ **"DEPLOY"** (éƒ¨ç½²) æŒ‰é’®
3. ç­‰å¾…éƒ¨ç½²å®Œæˆ (é€šå¸¸éœ€è¦ 2-5 åˆ†é’Ÿ)

ä½ ä¼šçœ‹åˆ°éƒ¨ç½²è¿›åº¦:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â— Deploying revision...                 â”‚
â”‚   â”œâ”€ Building container                 â”‚
â”‚   â”œâ”€ Pushing to registry                â”‚
â”‚   â””â”€ Deploying to Cloud Run             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ­¥éª¤ 8: æŸ¥çœ‹æ—¥å¿—

éƒ¨ç½²å®Œæˆå,æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸:

#### æ–¹æ³• 1: åœ¨æœåŠ¡é¡µé¢æŸ¥çœ‹æ—¥å¿—

1. åœ¨æœåŠ¡è¯¦æƒ…é¡µé¢,ç‚¹å‡»é¡¶éƒ¨çš„ **"LOGS"** æ ‡ç­¾
2. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ (æ ‡è®°ä¸ºçº¢è‰²çš„ ERROR æ—¥å¿—)

#### æ–¹æ³• 2: é€šè¿‡ Cloud Logging

1. è®¿é—®: https://console.cloud.google.com/logs
2. åœ¨æŸ¥è¯¢æ¡†ä¸­è¾“å…¥:
   ```
   resource.type="cloud_run_revision"
   resource.labels.service_name="pdf2md-test"
   severity>=ERROR
   ```
3. ç‚¹å‡» "Run query" (è¿è¡ŒæŸ¥è¯¢)

---

### æ­¥éª¤ 9: æµ‹è¯•æœåŠ¡

#### æµ‹è¯• 1: å¥åº·æ£€æŸ¥

åœ¨æµè§ˆå™¨è®¿é—®:
```
https://pdf2md-test-259381363877.australia-southeast1.run.app/api/health
```

**é¢„æœŸç»“æœ**:
```json
{
  "status": "ok",
  "timestamp": "2026-02-02T..."
}
```

#### æµ‹è¯• 2: è¯Šæ–­ç«¯ç‚¹

è®¿é—®:
```
https://pdf2md-test-259381363877.australia-southeast1.run.app/api/debug
```

**å¦‚æœçœ‹åˆ°è¿™æ ·çš„å“åº”,è¯´æ˜æ­£å¸¸**:
```json
{
  "markerService": {
    "health": {
      "status": "ok",
      "service": "marker-api"
    }
  }
}
```

**å¦‚æœçœ‹åˆ° error,è¯´æ˜ Marker æœåŠ¡æœªå¯åŠ¨** âš ï¸

#### æµ‹è¯• 3: å®é™…è½¬æ¢

1. è®¿é—®ä½ çš„åº”ç”¨é¦–é¡µ:
   ```
   https://pdf2md-test-259381363877.australia-southeast1.run.app
   ```

2. ä¸Šä¼ ä¸€ä¸ªå° PDF æ–‡ä»¶ (å»ºè®®å…ˆç”¨ 1-2 é¡µçš„æµ‹è¯•æ–‡ä»¶)

3. ç‚¹å‡» "å¼€å§‹è½¬æ¢"

4. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·** (æŒ‰ F12):
   - ç‚¹å‡» "Network" (ç½‘ç»œ) æ ‡ç­¾
   - å¦‚æœè½¬æ¢å¤±è´¥,æŸ¥çœ‹ `convert` è¯·æ±‚çš„å“åº”
   - ç°åœ¨ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯!

---

## ğŸ“Š æŸ¥çœ‹ç›‘æ§æŒ‡æ ‡

### å®æ—¶ç›‘æ§

1. åœ¨ Cloud Run æœåŠ¡é¡µé¢
2. ç‚¹å‡» **"METRICS"** (æŒ‡æ ‡) æ ‡ç­¾
3. æŸ¥çœ‹:
   - **Request count** (è¯·æ±‚æ•°) - æœ‰å¤šå°‘è¯·æ±‚
   - **Request latency** (å»¶è¿Ÿ) - å“åº”æ—¶é—´
   - **Memory utilization** (å†…å­˜ä½¿ç”¨) - æ˜¯å¦è¶…è¿‡é™åˆ¶ âš ï¸
   - **CPU utilization** (CPU ä½¿ç”¨)
   - **Container instance count** (å®ä¾‹æ•°)

### æŸ¥æ‰¾é—®é¢˜

å¦‚æœçœ‹åˆ°:
- âŒ **Memory utilization æ¥è¿‘ 100%** â†’ éœ€è¦å¢åŠ æ›´å¤šå†…å­˜
- âŒ **å¾ˆå¤š 500 é”™è¯¯** â†’ æŸ¥çœ‹æ—¥å¿—æ‰¾åŸå› 
- âŒ **è¯·æ±‚è¶…æ—¶** â†’ å¢åŠ  timeout è®¾ç½®

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### âŒ é—®é¢˜ 1: æ‰¾ä¸åˆ° "EDIT & DEPLOY NEW REVISION" æŒ‰é’®

**è§£å†³**:
- ç¡®ä¿ä½ æœ‰ç¼–è¾‘æƒé™
- æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ­£ç¡®çš„é¡¹ç›®
- å°è¯•åˆ·æ–°é¡µé¢

---

### âŒ é—®é¢˜ 2: éƒ¨ç½²åè¿˜æ˜¯å¤±è´¥

**æ£€æŸ¥æ¸…å•**:

1. âœ… å†…å­˜æ˜¯å¦è®¾ç½®ä¸º 2 GiB?
2. âœ… è¶…æ—¶æ˜¯å¦è®¾ç½®ä¸º 3600 ç§’?
3. âœ… å¹¶å‘è¯·æ±‚æ•°æ˜¯å¦è®¾ç½®ä¸º 1?
4. âœ… æ‰§è¡Œç¯å¢ƒæ˜¯å¦é€‰æ‹©äº† Second generation?

**æŸ¥çœ‹æ—¥å¿—**:
1. ç‚¹å‡» "LOGS" æ ‡ç­¾
2. ç­›é€‰ "ERROR" çº§åˆ«
3. æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯

---

### âŒ é—®é¢˜ 3: éƒ¨ç½²æˆåŠŸä½† /api/debug è¿”å›é”™è¯¯

**å¯èƒ½åŸå› **: Marker æœåŠ¡æœªå¯åŠ¨

**æ’æŸ¥æ­¥éª¤**:

1. **æŸ¥çœ‹å®¹å™¨æ—¥å¿—**:
   - åœ¨ LOGS æ ‡ç­¾ä¸­æœç´¢ "Marker"
   - æŸ¥æ‰¾ "Starting Marker API server" æ¶ˆæ¯
   - å¦‚æœæ²¡æ‰¾åˆ°,è¯´æ˜ Marker æœåŠ¡å¯åŠ¨å¤±è´¥

2. **æŸ¥çœ‹å¯åŠ¨è„šæœ¬æ—¥å¿—**:
   - æœç´¢ "docker-entrypoint"
   - æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

3. **å¯èƒ½çš„é”™è¯¯**:
   - `Memory limit exceeded` â†’ éœ€è¦æ›´å¤šå†…å­˜
   - `Failed to import marker` â†’ ä¾èµ–å®‰è£…é—®é¢˜
   - `Timeout` â†’ å¯åŠ¨æ—¶é—´å¤ªé•¿,å¢åŠ  timeout

---

### âŒ é—®é¢˜ 4: è½¬æ¢å¾ˆæ…¢

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **ä¿æŒçƒ­å¯åŠ¨** (å¢åŠ æˆæœ¬):
   ```
   Min instances: 1  â¬…ï¸ å§‹ç»ˆä¿æŒä¸€ä¸ªå®ä¾‹è¿è¡Œ
   ```

2. **å¢åŠ  CPU**:
   ```
   CPU: 2 æˆ– 4
   ```

3. **æ£€æŸ¥æ–‡ä»¶å¤§å°**:
   - å¤§æ–‡ä»¶éœ€è¦æ›´é•¿æ—¶é—´
   - å»ºè®®åˆ†æ‰¹è½¬æ¢å¤§æ–‡æ¡£

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### æ–¹æ¡ˆ 1: æŒ‰éœ€è¿è¡Œ (æ¨è)
```
Min instances: 0
Max instances: 2
Memory: 2 GiB
CPU: 2
```

**æˆæœ¬**:
- æ— è¯·æ±‚æ—¶: $0
- æœ‰è¯·æ±‚æ—¶: çº¦ $0.05-0.10 æ¯å°æ—¶å®ä¾‹è¿è¡Œæ—¶é—´
- **æ¨è**: é€‚åˆä½é¢‘ä½¿ç”¨

---

### æ–¹æ¡ˆ 2: ä¿æŒçƒ­å¯åŠ¨
```
Min instances: 1
Max instances: 2
Memory: 2 GiB
CPU: 2
```

**æˆæœ¬**:
- æŒç»­è¿è¡Œ: çº¦ $35-50 æ¯æœˆ
- **é€‚åˆ**: é«˜é¢‘ä½¿ç”¨,éœ€è¦å¿«é€Ÿå“åº”

---

## ğŸ“ é…ç½®æ€»ç»“

| è®¾ç½®é¡¹ | æ¨èå€¼ | è¯´æ˜ |
|--------|--------|------|
| Memory | **2 GiB** | Marker AI æœ€ä½è¦æ±‚ |
| CPU | **2** | åŠ å¿«å¤„ç†é€Ÿåº¦ |
| Timeout | **3600s** (1å°æ—¶) | æ”¯æŒå¤§æ–‡ä»¶è½¬æ¢ |
| Min instances | **0** (çœé’±) æˆ– **1** (å¿«é€Ÿ) | æŒ‰éœ€é€‰æ‹© |
| Max instances | **2** | é˜²æ­¢æˆæœ¬å¤±æ§ |
| Concurrency | **1** | Marker èµ„æºæ¶ˆè€—å¤§ |
| Execution env | **Second generation** | æ”¯æŒæ›´å¤šå†…å­˜ |

---

## ğŸ”— å¿«é€Ÿé“¾æ¥

### ç›´æ¥è®¿é—®

- **æœåŠ¡é¡µé¢**: https://console.cloud.google.com/run/detail/australia-southeast1/pdf2md-test
- **æ—¥å¿—é¡µé¢**: https://console.cloud.google.com/logs/query?project=pdf2md-486205
- **ç›‘æ§é¡µé¢**: https://console.cloud.google.com/run/detail/australia-southeast1/pdf2md-test/metrics

### æœåŠ¡ç«¯ç‚¹

- **åº”ç”¨é¦–é¡µ**: https://pdf2md-test-259381363877.australia-southeast1.run.app
- **å¥åº·æ£€æŸ¥**: https://pdf2md-test-259381363877.australia-southeast1.run.app/api/health
- **è¯Šæ–­ç«¯ç‚¹**: https://pdf2md-test-259381363877.australia-southeast1.run.app/api/debug

---

## âœ… éªŒè¯æ¸…å•

é…ç½®å®Œæˆå,ç¡®è®¤ä»¥ä¸‹é¡¹ç›®:

- [ ] Memory è®¾ç½®ä¸º 2 GiB
- [ ] CPU è®¾ç½®ä¸º 2
- [ ] Timeout è®¾ç½®ä¸º 3600 ç§’
- [ ] Concurrency è®¾ç½®ä¸º 1
- [ ] æ‰§è¡Œç¯å¢ƒé€‰æ‹© Second generation
- [ ] éƒ¨ç½²æˆåŠŸ (æ²¡æœ‰é”™è¯¯)
- [ ] /api/health è¿”å› OK
- [ ] /api/debug æ˜¾ç¤º Marker æœåŠ¡å¥åº·
- [ ] å®é™…è½¬æ¢æµ‹è¯•é€šè¿‡

---

## ğŸ†˜ éœ€è¦å¸®åŠ©?

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½å®Œæˆäº†ä½†è¿˜æ˜¯å¤±è´¥:

1. **æˆªå›¾ä»¥ä¸‹ä¿¡æ¯**:
   - Cloud Run é…ç½®é¡µé¢
   - LOGS æ ‡ç­¾ä¸­çš„é”™è¯¯æ—¥å¿—
   - /api/debug çš„å“åº”
   - æµè§ˆå™¨ F12 Network æ ‡ç­¾ä¸­çš„é”™è¯¯

2. **æ”¶é›†è¯Šæ–­ä¿¡æ¯**:
   - ä¸Šä¼ çš„ PDF æ–‡ä»¶å¤§å°
   - å…·ä½“çš„é”™è¯¯æ¶ˆæ¯
   - é—®é¢˜å‘ç”Ÿçš„æ—¶é—´

---

*æœ€åæ›´æ–°: 2026-02-02*
